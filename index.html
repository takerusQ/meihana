<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaf Jump Game</title>

<style>
body {
  margin: 0;
  text-align: center;
  font-family: sans-serif;
  background: #87ceeb;
}

h1 {
  margin: 10px 0;
}

button {
  font-size: 18px;
  padding: 10px 20px;
  margin: 10px;
}

canvas {
  background: #bde0fe;
  display: block;
  margin: 0 auto;
  border: 3px solid #333;
  touch-action: none;
}
</style>
</head>

<body>

<h1>Leaf Jump Game</h1>
<button onclick="startGame()">üéÆ „Ç≤„Éº„É†„ÇíÈÅä„Å∂</button>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let scale = 1;
function resizeCanvas() {
  const baseWidth = 400;
  const baseHeight = 600;

  scale = Math.min(
    window.innerWidth / baseWidth,
    window.innerHeight / baseHeight
  );

  canvas.width = baseWidth * scale;
  canvas.height = baseHeight * scale;

  ctx.setTransform(scale, 0, 0, scale, 0, 0);
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

let gameStarted = false;
let gravity = 0.5;
let score = 0;

const player = {
  x: 180,
  y: 400,
  width: 40,
  height: 40,
  dy: 0,
  jumping: false
};

const leaves = [];
const leafWidth = 80;
const leafHeight = 20;

function createLeaf(y) {
  const x = Math.random() * (400 - leafWidth);
  leaves.push({ x, y });
}

for (let i = 0; i < 6; i++) {
  createLeaf(i * 120);
}

function startGame() {
  gameStarted = true;
  score = 0;
  player.y = 400;
  player.dy = 0;
  leaves.length = 0;
  for (let i = 0; i < 6; i++) {
    createLeaf(i * 120);
  }
  requestAnimationFrame(update);
}

/* =========================
   ÁîªÂÉè„É≠„Éº„ÉâÔºàÂ≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ‰ªò„ÅçÔºâ
========================= */

function loadImage(src) {
  const img = new Image();
  img.src = src;
  return new Promise((resolve) => {
    img.onload = () => resolve(img);
    img.onerror = () => resolve(null);
  });
}

let images = {};

async function loadAssets() {
  images.idle = await loadImage("assets/char/idle.png");
  images.leaf = await loadImage("assets/leaf/fresh.png");
  images.bg = await loadImage("assets/bg/spring.png");
}
loadAssets();

/* =========================
   ÊèèÁîª
========================= */

function drawPlayer() {
  if (images.idle) {
    ctx.drawImage(images.idle, player.x, player.y, player.width, player.height);
  } else {
    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºà„Éñ„É≠„ÉÉ„ÇØÊèèÁîªÔºâ
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    ctx.fillStyle = "#fff";
    ctx.fillRect(player.x+8, player.y+10, 8, 8);
    ctx.fillRect(player.x+24, player.y+10, 8, 8);

    ctx.fillStyle = "#000";
    ctx.fillRect(player.x+10, player.y+12, 4, 4);
    ctx.fillRect(player.x+26, player.y+12, 4, 4);

    ctx.fillStyle = "#ff69b4";
    ctx.fillRect(player.x+16, player.y+25, 8, 4);
  }
}

function drawLeaves() {
  leaves.forEach(leaf => {
    if (images.leaf) {
      ctx.drawImage(images.leaf, leaf.x, leaf.y, leafWidth, leafHeight);
    } else {
      ctx.fillStyle = "#27ae60";
      ctx.fillRect(leaf.x, leaf.y, leafWidth, leafHeight);
    }
  });
}

function drawBackground() {
  if (images.bg) {
    ctx.drawImage(images.bg, 0, 0, 400, 600);
  }
}

/* =========================
   Êõ¥Êñ∞
========================= */

function update() {
  if (!gameStarted) return;

  ctx.clearRect(0, 0, 400, 600);

  drawBackground();

  player.dy += gravity;
  player.y += player.dy;

  if (player.y > 500) {
    alert("Game Over! Score: " + score);
    gameStarted = false;
    return;
  }

  leaves.forEach(leaf => {
    if (
      player.x < leaf.x + leafWidth &&
      player.x + player.width > leaf.x &&
      player.y + player.height < leaf.y + leafHeight &&
      player.y + player.height > leaf.y &&
      player.dy > 0
    ) {
      player.dy = -10;
      score++;
    }
  });

  drawLeaves();
  drawPlayer();

  ctx.fillStyle = "#000";
  ctx.font = "20px sans-serif";
  ctx.fillText("Score: " + score, 10, 30);

  requestAnimationFrame(update);
}

/* =========================
   Êìç‰ΩúÔºàPC + „Çπ„Éû„ÉõÔºâ
========================= */

document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") player.x -= 20;
  if (e.key === "ArrowRight") player.x += 20;
});

canvas.addEventListener("touchstart", e => {
  const touchX = e.touches[0].clientX;
  if (touchX < window.innerWidth / 2) {
    player.x -= 20;
  } else {
    player.x += 20;
  }
});
</script>

</body>
</html>